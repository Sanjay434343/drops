<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product List</title>
  <style>
    /* Styles as before */
  </style>
</head>
<body>
  <div class="container">
    <h1>Product List</h1>
    <div class="product-list" id="productList">
      <!-- Products will be dynamically added here -->
    </div>
  </div>

  <!-- The Modal -->
  <div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <div class="modal-body" id="modalBody">
        <!-- Modal body content will be dynamically added here -->
        <input type="file" id="imageUpload" accept="image/*">
      </div>
      <div class="modal-footer">
        <button class="btn-modal" onclick="saveModal()">Save</button>
        <button class="btn-modal cancel" onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>


  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

  <script>
 
    const firebaseConfig = {
       apiKey: "AIzaSyC3WxZBaNJoZA2p7oe6ihTJCFOE6Y0U_7Q",
  authDomain: "dropshipping-98eb5.firebaseapp.com",
  projectId: "dropshipping-98eb5",
  storageBucket: "dropshipping-98eb5.appspot.com",
  messagingSenderId: "904925867242",
  appId: "1:904925867242:web:af0abda866826e92f8fb93",
  measurementId: "G-BVZR8HY1SR"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const productList = document.getElementById('productList');
    const modal = document.getElementById('myModal');
    const modalBody = document.getElementById('modalBody');
    let currentProductKey = null;

    // Function to fetch and display products
    function fetchProducts() {
        productList.innerHTML = ''; // Clear existing product list

        // Reference to 'products' node in Firebase
        const productsRef = database.ref('products');

        productsRef.once('value', (snapshot) => {
            snapshot.forEach((childSnapshot) => {
                const productKey = childSnapshot.key;
                const productData = childSnapshot.val();

                // Create HTML elements for each product
                const productItem = document.createElement('div');
                productItem.classList.add('product-item');
                productItem.setAttribute('data-key', productKey);

                // Product Name
                const productName = document.createElement('h3');
                productName.textContent = productData.name;
                productItem.appendChild(productName);

                // Product Image
                if (productData.base64Image) {
                    const productImage = document.createElement('img');
                    productImage.src = productData.base64Image;
                    productImage.alt = productData.name;
                    productImage.classList.add('product-image');
                    productItem.appendChild(productImage);
                }

                // Product Price
                const productPrice = document.createElement('p');
                productPrice.textContent = `Price: ${productData.price}`;
                productItem.appendChild(productPrice);

                // Product Tags
                const tagsString = productData.tags && productData.tags.length > 0 ? productData.tags.join(', ') : '';
                const productTags = document.createElement('p');
                productTags.textContent = `Tags: ${tagsString}`;
                productItem.appendChild(productTags);

                // Buttons (Change Image, Change Name, Change Tag, Delete)
                const btnGroup = document.createElement('div');
                btnGroup.classList.add('btn-group');
                const changeImageBtn = createButton('Change Image', () => openChangeImageModal(productKey));
                const changeNameBtn = createButton('Change Name', () => openChangeNameModal(productKey));
                const changeTagBtn = createButton('Change Tag', () => openChangeTagModal(productKey));
                const deleteBtn = createButton('Delete', () => deleteProduct(productKey));
                btnGroup.appendChild(changeImageBtn);
                btnGroup.appendChild(changeNameBtn);
                btnGroup.appendChild(changeTagBtn);
                btnGroup.appendChild(deleteBtn);
                productItem.appendChild(btnGroup);

                productList.appendChild(productItem);
            });
        });
    }

    // Function to create a button element
    function createButton(text, onClick) {
        const button = document.createElement('button');
        button.textContent = text;
        button.classList.add('btn');
        button.addEventListener('click', onClick);
        return button;
    }

    // Function to open modal for changing product image
    function openChangeImageModal(productKey) {
        currentProductKey = productKey;
        modalBody.innerHTML = ''; // Clear previous modal content

        const inputField = document.createElement('input');
        inputField.type = 'file';
        inputField.accept = 'image/*';
        inputField.classList.add('modal-input');
        inputField.addEventListener('change', handleImageUpload);

        modalBody.appendChild(inputField);
        modal.style.display = 'block';
    }

    // Function to handle image upload and convert to base64
    function handleImageUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function () {
            const base64Image = reader.result;
            displayImagePreview(base64Image);
        };
    }

    // Function to display image preview in modal
    function displayImagePreview(base64Image) {
        const imgPreview = document.createElement('img');
        imgPreview.src = base64Image;
        imgPreview.classList.add('product-image-preview');

        modalBody.appendChild(imgPreview);
    }

    // Function to open modal for changing product name
    function openChangeNameModal(productKey) {
        currentProductKey = productKey;
        modalBody.innerHTML = ''; // Clear previous modal content

        const inputField = document.createElement('input');
        inputField.type = 'text';
        inputField.placeholder = 'Enter new product name';
        inputField.classList.add('modal-input');

        modalBody.appendChild(inputField);
        modal.style.display = 'block';
    }

    // Function to open modal for changing product tags
    function openChangeTagModal(productKey) {
        currentProductKey = productKey;
        modalBody.innerHTML = ''; // Clear previous modal content

        const inputField = document.createElement('input');
        inputField.type = 'text';
        inputField.placeholder = 'Enter new tags separated by commas';
        inputField.classList.add('modal-input');

        modalBody.appendChild(inputField);
        modal.style.display = 'block';
    }

    // Function to delete a product
    function deleteProduct(productKey) {
        const productRef = database.ref(`products/${productKey}`);
        productRef.remove()
            .then(() => {
                console.log('Product successfully deleted!');
                fetchProducts(); // Refresh the product list
            })
            .catch((error) => {
                console.error('Error removing product: ', error);
            });
    }

    // Function to close the modal
    function closeModal() {
        modal.style.display = 'none';
        modalBody.innerHTML = ''; // Clear modal content
    }

    // Function to save changes from the modal
    function saveModal() {
        if (currentProductKey) {
            // Update product with new image
            const imageElement = modalBody.querySelector('.product-image-preview');
            if (imageElement) {
                const base64Image = imageElement.src;
                updateProductImage(currentProductKey, base64Image);
            }
        }
        closeModal();
    }

    // Function to update product image in Firebase
   
    // Function to update product image in Firebase
    function updateProductImage(productKey, base64Image) {
        const productRef = database.ref(`products/${productKey}`);
        productRef.update({
            base64Image: base64Image
        }).then(() => {
            console.log('Product image updated successfully!');
            fetchProducts(); // Refresh the product list
        }).catch((error) => {
            console.error('Error updating product image: ', error);
        });
    }

    // Fetch products when the page loads
    window.onload = fetchProducts;
);
  </script>
</body>
</html>
